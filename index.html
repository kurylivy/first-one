<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Поточний баланс банок Monobank</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            min-height: 100vh;
        }
        .half {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .left-half {
            background: #FFC0CB;
            color: #333;
        }
        .right-half {
            background: #87CEFA;
            color: #333;
        }
        .jar-card {
            background: rgba(255,255,255,0.75);
            border-radius: 1rem;
            padding: 2rem;
            min-width: 280px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }
        .jar-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin-bottom: 1rem;
            object-fit: cover;
            border: 2px solid #fff;
        }
        .balance {
            font-size: 2rem;
            font-weight: bold;
        }
        @media (max-width: 767.98px) {
            .half {
                min-height: auto;
                height: auto;
                padding: 2rem 0;
            }
        }
    </style>
</head>
<body>
<div class="container-fluid h-100">
    <div class="row h-100 flex-column flex-md-row">
        <!-- Ліва банка -->
        <div class="col-12 col-md-6 half left-half" id="left-bank">
            <div class="jar-card text-center" id="jar1-card">
                <div class="mb-2">
                    <img src="https://placehold.co/64x64?text=..." alt="Owner" class="jar-avatar" id="jar1-avatar">
                </div>
                <div class="mb-1 fs-5" id="jar1-title">Завантаження...</div>
                <div class="mb-2 text-muted" id="jar1-owner"></div>
                <div class="balance" id="jar1-balance"></div>
            </div>
        </div>
        <!-- Права банка -->
        <div class="col-12 col-md-6 half right-half" id="right-bank">
            <div class="jar-card text-center" id="jar2-card">
                <div class="mb-2">
                    <img src="https://placehold.co/64x64?text=..." alt="Owner" class="jar-avatar" id="jar2-avatar">
                </div>
                <div class="mb-1 fs-5" id="jar2-title">Завантаження...</div>
                <div class="mb-2 text-muted" id="jar2-owner"></div>
                <div class="balance" id="jar2-balance"></div>
            </div>
        </div>
    </div>
</div>
<script>
/**
 * Заміни ці ID на свої реальні jarId з публічних сторінок Monobank банок.
 * Наприклад: jar1Id = "AZduYj6iaM"
 */
const jar1Id = 'AZduYj6iaM'; // <-- ВСТАВ СВІЙ ПЕРШИЙ jarId (короткий)
const jar2Id = 'AZduYj6iaM'; // <-- ВСТАВ СВІЙ ДРУГИЙ jarId (короткий)

/**
 * Отримує довгий jarId через API send.monobank.ua
 * @param {string} shortJarId
 * @returns {Promise<string>} extJarId (longJarId)
 */
async function getLongJarId(shortJarId) {
    const response = await fetch('https://send.monobank.ua/api/handler', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            "c": "hello",
            "clientId": shortJarId,
            "Pc": Math.random().toString(36).substring(2)
        })
    });
    if (!response.ok) throw new Error('Не вдалося отримати longJarId');
    const data = await response.json();
    if (!data.extJarId) throw new Error('extJarId не знайдено');
    return data.extJarId;
}

/**
 * Отримує дані банки через longJarId
 * @param {string} longJarId
 * @returns {Promise<object>} jarData
 */
async function getJarInfo(longJarId) {
    const response = await fetch(`https://api.monobank.ua/bank/jar/${longJarId}`);
    if (!response.ok) throw new Error('Не вдалося завантажити дані банки');
    return await response.json();
}

/**
 * Форматує суму в гривнях
 * @param {number} amount
 * @returns {string}
 */
function formatUAH(amount) {
    return (amount / 100).toLocaleString('uk-UA', { style: 'currency', currency: 'UAH', minimumFractionDigits: 2 });
}

/**
 * Оновлює інформацію про банку на сторінці
 * @param {object} jarData
 * @param {string} prefix
 */
function renderJar(jarData, prefix) {
    document.getElementById(prefix + '-avatar').src = jarData.ownerIcon || 'https://placehold.co/64x64?text=?';
    document.getElementById(prefix + '-title').innerText = jarData.title || 'Без назви';
    document.getElementById(prefix + '-owner').innerText = jarData.ownerName || '';
    document.getElementById(prefix + '-balance').innerText = jarData.amount !== undefined
        ? formatUAH(jarData.amount)
        : 'Немає даних';
}

// Головна функція
async function updateJars() {
    // Масив з jarId та префіксами для рендеру
    const jars = [
        { id: jar1Id, prefix: 'jar1' },
        { id: jar2Id, prefix: 'jar2' }
    ];
    for (const jar of jars) {
        try {
            const longJarId = await getLongJarId(jar.id);
            const jarData = await getJarInfo(longJarId);
            renderJar(jarData, jar.prefix);
        } catch (e) {
            document.getElementById(jar.prefix + '-title').innerText = 'Помилка';
            document.getElementById(jar.prefix + '-balance').innerText = (e && e.message) ? e.message : 'Невідома помилка';
        }
    }
}

// Оновлюємо при завантаженні
updateJars();

// Можна періодично оновлювати (наприклад, кожні 60 секунд)
setInterval(updateJars, 60000);
</script>
</body>
</html>
