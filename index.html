<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Поточний баланс банок Monobank</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            min-height: 100vh;
        }
        .half {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .left-half {
            background: #FFC0CB;
            color: #333;
        }
        .right-half {
            background: #87CEFA;
            color: #333;
        }
        .jar-card {
            background: rgba(255,255,255,0.75);
            border-radius: 1rem;
            padding: 2rem;
            min-width: 280px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }
        .jar-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin-bottom: 1rem;
            object-fit: cover;
            border: 2px solid #fff;
        }
        .balance {
            font-size: 2rem;
            font-weight: bold;
        }
        .donate-buttons {
            margin-top: 1.5rem;
        }
        .donate-btn {
            min-width: 90px;
            margin: 0 0.3rem 0.5rem 0.3rem;
            font-weight: 600;
        }
        @media (max-width: 767.98px) {
            .half {
                min-height: auto;
                height: auto;
                padding: 2rem 0;
            }
        }
    </style>
</head>
<body>
<div class="container-fluid h-100">
    <div class="row h-100 flex-column flex-md-row">
        <!-- Ліва банка -->
        <div class="col-12 col-md-6 half left-half">
            <div class="jar-card text-center" id="jar1-card">
                <div class="mb-2">
                    <img src="https://placehold.co/64x64?text=..." alt="Owner" class="jar-avatar" id="jar1-avatar">
                </div>
                <div class="mb-1 fs-5" id="jar1-title">Завантаження...</div>
                <div class="mb-2 text-muted" id="jar1-owner"></div>
                <div class="balance" id="jar1-balance"></div>
                <div class="donate-buttons" id="jar1-donate"></div>
            </div>
        </div>
        <!-- Права банка -->
        <div class="col-12 col-md-6 half right-half">
            <div class="jar-card text-center" id="jar2-card">
                <div class="mb-2">
                    <img src="https://placehold.co/64x64?text=..." alt="Owner" class="jar-avatar" id="jar2-avatar">
                </div>
                <div class="mb-1 fs-5" id="jar2-title">Завантаження...</div>
                <div class="mb-2 text-muted" id="jar2-owner"></div>
                <div class="balance" id="jar2-balance"></div>
                <div class="donate-buttons" id="jar2-donate"></div>
            </div>
        </div>
    </div>
</div>
<script>
/**
 * Очікується файл balances.json такого формату:
 * {
 *   "jars": [
 *     {
 *       "ownerName": "Антон Г.",
 *       "title": "На податки",
 *       "amount": 4500002,
 *       "ownerIcon": "https://ava-img.monobank.com.ua/...",
 *       "currency": 980,
 *       "jarId": "AZduYj6iaM"
 *     },
 *     {
 *       "ownerName": "Інша банка",
 *       "title": "На щось інше",
 *       "amount": 123456,
 *       "ownerIcon": "https://ava-img.monobank.com.ua/...",
 *       "currency": 980,
 *       "jarId": "BZtPj2hbbC"
 *     }
 *   ],
 *   "updated_at": "2025-06-24T12:00:00Z"
 * }
 */

function formatUAH(amount) {
    return (amount / 100).toLocaleString('uk-UA', {style: 'currency', currency: 'UAH', minimumFractionDigits: 2});
}

function renderDonateButtons(jarId, prefix) {
    if (!jarId) return;
    const amounts = [100, 200, 500];
    const container = document.getElementById(`${prefix}-donate`);
    container.innerHTML = amounts.map(amount =>
        `<a class="btn btn-success donate-btn" href="https://send.monobank.ua/jar/${jarId}?amount=${amount}" target="_blank" rel="noopener noreferrer">${amount} грн</a>`
    ).join("");
}

function renderJar(jarData, prefix) {
    document.getElementById(prefix + '-avatar').src = jarData.ownerIcon || 'https://placehold.co/64x64?text=?';
    document.getElementById(prefix + '-title').innerText = jarData.title || 'Без назви';
    document.getElementById(prefix + '-owner').innerText = jarData.ownerName || '';
    document.getElementById(prefix + '-balance').innerText = (jarData.amount !== undefined)
        ? formatUAH(jarData.amount)
        : 'Немає даних';
    renderDonateButtons(jarData.jarId, prefix);
}

function renderUpdatedAt(updated_at) {
    if (!updated_at) return;
    let el = document.getElementById('updated-at');
    if (!el) {
        el = document.createElement('div');
        el.id = 'updated-at';
        el.className = "text-center mt-3 text-muted";
        document.body.appendChild(el);
    }
    el.innerText = "Останнє оновлення: " + new Date(updated_at).toLocaleString('uk-UA');
}

async function updateJars() {
    try {
        const response = await fetch('balances.json', {cache: 'no-store'});
        if (!response.ok) throw new Error('balances.json не знайдено');
        const data = await response.json();
        if (Array.isArray(data.jars)) {
            if (data.jars[0]) renderJar(data.jars[0], 'jar1');
            if (data.jars[1]) renderJar(data.jars[1], 'jar2');
        }
        renderUpdatedAt(data.updated_at);
    } catch (e) {
        document.getElementById('jar1-title').innerText = 'Помилка';
        document.getElementById('jar1-balance').innerText = e.message;
        document.getElementById('jar2-title').innerText = 'Помилка';
        document.getElementById('jar2-balance').innerText = e.message;
    }
}

updateJars();
setInterval(updateJars, 60000);
</script>
</body>
</html>
